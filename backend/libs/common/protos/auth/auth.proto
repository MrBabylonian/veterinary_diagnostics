syntax = "proto3";

package auth;

// ---------------------------------------------------------
// 1. DATA MODELS
// ---------------------------------------------------------

// TODO: ADD STATUS

enum AuthProvider {
  LOCAL = 0;
  GOOGLE = 1;
  MICROSOFT = 2;
  APPLE = 3;
}

// ---------------------------------------------------------
// 2. SERVICE DEFINITION (Java Side)
// ---------------------------------------------------------

// Python user service calls this during registration
service AuthService {
  rpc CreateCredential(CreateCredentialRequest) returns(CreateCredentialResponse);

// Frontend/Gateway calls this for login
  rpc ValidateCredential(ValidateCredentialRequest) returns(ValidateCredentialResponse);
// Python user service calls this to cleanup if profile creation fails (saga compensation)
  rpc DeleteCredential(DeleteCredentialRequest) returns(DeleteCredentialResponse);
}

// ---------------------------------------------------------
// 3. DTOs
// ---------------------------------------------------------

message CreateCredentialRequest {
  string email = 1;
  string password = 2; // Raw password (sent over mTLS)
  AuthProvider provider = 3;
  optional string auth_subject = 4; // For 3rd party providers
}

message CreateCredentialResponse {
  string user_id = 1; // The UUIDv7 generated by Java
  string email = 2;
}

message ValidateCredentialRequest {
  string email = 1;
  string password = 2;
}

message ValidateCredentialResponse {
  string token = 1; // JWT
  string user_id = 2;
}

message DeleteCredentialRequest {
  string user_id = 1;
}

message DeleteCredentialResponse {
  bool success = 1;
}


